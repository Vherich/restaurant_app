<div class="container mt-4">
  <h1 class="mb-3">New Order</h1>

  <%= form_with(model: @order, class: 'row g-3') do |form| %>
    <div class="col-md-6">
      <%= form.label :table_id, "Table", class: 'form-label' %>
      <%= form.collection_select :table_id, @tables, :id, :number, {}, class: 'form-select' %>
    </div>

    <div class="col-12">
      <h5 class="mt-3">Menu Items:</h5>
    </div>

    <% @menu_items.each do |item| %>
      <div class="col-md-4">
        <div class="card mb-3">
          <div class="card-body">
            <h6 class="card-title"><%= item.name %> - <%= number_to_currency(item.price) %></h6>

            <% if @order.order_items.find_by(menu_item_id: item.id) %>
              <%= form.fields_for :order_items, @order.order_items.find_by(menu_item_id: item.id) do |order_item_form| %>
                <%= order_item_form.hidden_field :menu_item_id, value: item.id %>
                <div class="input-group">
                  <span class="input-group-text">Qty:</span>
                  <%= order_item_form.number_field :quantity, min: 0, class: 'form-control' %>
                </div>
              <% end %>
            <% else %>
              <%= form.fields_for :order_items, OrderItem.new(menu_item_id: item.id, quantity: 0) do |order_item_form| %>
                <%= order_item_form.hidden_field :menu_item_id, value: item.id %>
                <div class="input-group">
                  <span class="input-group-text">Qty:</span>
                  <%= order_item_form.number_field :quantity, min: 0, class: 'form-control' %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <div class="col-12 d-grid gap-2">
      <%= form.submit "Create Order", class: 'btn btn-primary' %>
    </div>
  <% end %> <%# This is the closing tag for the form_with block %>
</div>
