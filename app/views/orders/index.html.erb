<div class="container mt-4">
  <%# Current Orders Section %>
  <section id="current-orders">
    <h1 class="mb-3">Pedidos Atuais</h1>
    <%= link_to 'Criar Pedido', new_order_path, class: 'btn btn-primary mb-3' %>
    <% if @current_orders.any? %>
      <div class="table-responsive"> <%# Add responsive wrapper %>
        <table class="table table-striped table-hover align-middle"> <%# Improve readability with vertical alignment %>
          <thead>
            <tr>
              <th>ID</th>
              <th>Mesa</th>
              <th>Status</th>
              <th>Hora</th>
              <th>Total</th>
              <th>Itens</th>
              <th colspan="2">Ações</th> <%# Merge action columns for visual clarity %>
            </tr>
          </thead>
          <tbody>
            <% @current_orders.each do |order| %>
              <% if order.order_items.any? { |item| item.quantity > 0 } %>
                <tr>
                  <td><%= order.id %></td>
                  <td><%= order.table.number %></td>
                  <td>
                    <span class="badge bg-<%= order.status_badge_class %>">
                      <%= order.status.capitalize %>
                    </span>
                  </td>
                  <td><%= order.created_at.strftime("%Y-%m-%d %H:%M") %></td>
                  <td><%= number_to_currency(order.total) %></td>
                  <td>
                    <ul class="list-unstyled">
                      <% order.order_items.each do |order_item| %>
                        <% if order_item.quantity > 0 %>
                          <li><%= order_item.menu_item.name %> x <%= order_item.quantity %></li>
                        <% end %>
                      <% end %>
                    </ul>
                  </td>
                  <td>
                    <% if order.status == 'pending' %>
                      <%= button_to 'Marcar como Pronto', order_path(order, order: { status: 'ready' }), method: :patch, class: 'btn btn-primary btn-sm' %>
                    <% elsif order.status == 'ready' %>
                      <%= form_with(model: order, url: order_path(order), method: :patch, class: 'd-flex align-items-center') do |form| %>
                        <%= form.hidden_field :status, value: 'completed' %>
                        <%= form.number_field :amount_paid, step: 0.01, min: order.total, placeholder: 'Quantia Paga', class: 'form-control me-2' %>
                        <%= form.submit 'Completo', class: 'btn btn-success btn-sm' %>
                      <% end %>
                    <% end %>
                    <%= link_to 'Editar Pedido', edit_order_path(order), class: 'btn btn-secondary btn-sm my-2' %>
                    <%= button_to 'Cancelar', order_path(order), method: :delete, data: { confirm: 'Tem certeza?' }, class: 'btn btn-danger btn-sm' %>
                  </td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-center text-muted">Sem pedidos atuais.</p>
    <% end %>
  </section>

  <%# Completed Orders Section %>
  <section id="completed-orders" class="mt-5">
    <h1 class="mb-3">Pedidos Completos</h1>
    <% if @completed_orders.any? %>
      <div class="table-responsive"> <%# Add responsive wrapper %>
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Mesa</th>
              <th>Status</th>
              <th>Hora Finalização</th>
              <th>Total</th>
              <th>Itens</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
           <% @completed_orders.each do |order| %>
            <tr>
              <% if order.order_items.any? { |item| item.quantity > 0 } %>
                <td><%= order.id %></td>
                <td><%= order.table.number %></td>
                <td>
                  <span class="badge bg-<%= order.status_badge_class %>">
                    <%= order.status.capitalize %>
                  </span>
                </td>
                <td><%= order.updated_at.strftime("%Y-%m-%d %H:%M") %></td>
                <td><%= number_to_currency(order.total) %></td>
                <td>
                  <ul class="list-unstyled">
                    <% order.order_items.each do |order_item| %>
                      <% if order_item.quantity > 0 %>
                        <li><%= order_item.menu_item.name %> x <%= order_item.quantity %></li>
                      <% end %>
                    <% end %>
                  </ul>
                </td>
                <td>
                  <%= link_to 'Editar Pedido', edit_order_path(order), class: 'btn btn-secondary btn-sm my-2' %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-center text-muted">Sem pedidos completos.</p>
    <% end %>
  </section>
</div>
